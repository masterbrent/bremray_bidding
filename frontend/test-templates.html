<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Templates API Test</title>
    <style>
        body { font-family: monospace; padding: 20px; }
        .result { 
            background: #f5f5f5; 
            padding: 10px; 
            margin: 10px 0; 
            white-space: pre-wrap; 
            border-radius: 4px;
        }
        .error { background: #fee; color: #c00; }
        .success { background: #efe; color: #060; }
        button { margin: 5px; padding: 5px 10px; }
    </style>
</head>
<body>
    <h1>Templates API Test</h1>
    <div>
        <button onclick="testListTemplates()">List Templates</button>
        <button onclick="testCreateTemplate()">Create Template</button>
        <button onclick="testAddItemToTemplate()">Add Item to Template</button>
        <button onclick="testDeleteTemplate()">Delete Template</button>
    </div>
    <div id="results"></div>

    <script>
        const apiUrl = 'http://localhost:8080/api';
        let lastTemplateId = null;

        function addResult(text, isError = false) {
            const div = document.createElement('div');
            div.className = isError ? 'result error' : 'result success';
            div.textContent = text;
            document.getElementById('results').appendChild(div);
        }

        async function testListTemplates() {
            try {
                const response = await fetch(`${apiUrl}/templates`);
                const data = await response.json();
                addResult(`GET /templates: ${response.status}\n${JSON.stringify(data, null, 2)}`);
                if (data && data.length > 0) {
                    lastTemplateId = data[0].id;
                }
            } catch (error) {
                addResult(`Error: ${error.message}`, true);
            }
        }

        async function testCreateTemplate() {
            try {
                // First get an item ID to use
                const itemsResponse = await fetch(`${apiUrl}/items`);
                const items = await itemsResponse.json();
                if (!items || items.length === 0) {
                    addResult('No items found. Create an item first.', true);
                    return;
                }

                const response = await fetch(`${apiUrl}/templates`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        name: 'Test Template ' + Date.now(),
                        description: 'Created via test page',
                        items: [{
                            itemId: items[0].id,
                            defaultQuantity: 2
                        }]
                    })
                });
                const data = await response.json();
                addResult(`POST /templates: ${response.status}\n${JSON.stringify(data, null, 2)}`);
                if (data.id) {
                    lastTemplateId = data.id;
                }
            } catch (error) {
                addResult(`Error: ${error.message}`, true);
            }
        }

        async function testAddItemToTemplate() {
            if (!lastTemplateId) {
                addResult('No template ID. Create a template first.', true);
                return;
            }

            try {
                // Get items
                const itemsResponse = await fetch(`${apiUrl}/items`);
                const items = await itemsResponse.json();
                if (!items || items.length < 2) {
                    addResult('Need at least 2 items. Create more items first.', true);
                    return;
                }

                const response = await fetch(`${apiUrl}/templates/${lastTemplateId}/items`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        itemId: items[1].id,
                        defaultQuantity: 3
                    })
                });
                const data = await response.text();
                addResult(`POST /templates/${lastTemplateId}/items: ${response.status}\n${data}`);
            } catch (error) {
                addResult(`Error: ${error.message}`, true);
            }
        }

        async function testDeleteTemplate() {
            if (!lastTemplateId) {
                addResult('No template ID. Create a template first.', true);
                return;
            }

            try {
                const response = await fetch(`${apiUrl}/templates/${lastTemplateId}`, {
                    method: 'DELETE'
                });
                addResult(`DELETE /templates/${lastTemplateId}: ${response.status}`);
                lastTemplateId = null;
            } catch (error) {
                addResult(`Error: ${error.message}`, true);
            }
        }

        // Test on load
        window.onload = () => {
            addResult('Templates API Test Ready');
            testListTemplates();
        };
    </script>
</body>
</html>